(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5803:function(e,s,n){Promise.resolve().then(n.bind(n,3598))},3598:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return q}});var t=n(7437);n(9745);var l=n(3389),i=n.n(l),a=n(2265),r=n(2759),o=n(2390),c=n.n(o),d=n(4883),u=n(4542),m=n(740),h=n(7633),x=n(1342),j=n(5903),p=n(6916),v=n(771),f=n(5034),N=n(20),b=n(1655),g=n(3794),w=n(3067),y=n(3255),k=n(3276),C=n(504);function G(e){let{connection:s}=e,n=(0,a.useRef)(null),l=(0,a.useRef)(null),o=(0,a.useRef)(null),G=(0,a.useRef)(null),[S,Z]=(0,a.useState)(""),[E,P]=(0,a.useState)([]),_=()=>s?s.route.map(e=>[e.coords.lon,e.coords.lat]):[],I=s?s.id:null;return(0,a.useEffect)(()=>{let e=new d.Z;e.addLayer(new N.Z({source:new h.Z})),e.setTarget(l.current),e.setView(new u.ZP({center:[0,0],zoom:2}));let s=new m.Z({element:G.current,autoPan:{animation:{duration:250}}});return o.current=s,e.addOverlay(s),e.on("click",e=>{let s=(0,k.bU)(e.coordinate);console.log(s),c()(s.toString()),P(s)}),e.on("pointermove",s=>{let n=e.forEachFeatureAtPixel(s.pixel,e=>e);if(o.current&&o.current.setPosition(void 0),n&&"marker"===n.get("type")){let e=s.coordinate;Z(n.get("description")),o.current&&o.current.setPosition(e)}}),n.current=e,()=>{n.current&&n.current.setTarget(void 0)}},[]),(0,a.useEffect)(()=>{let e=_(),t=new x.Z(e);t.transform("EPSG:4326","EPSG:3857");let l=new p.Z({type:"route",geometry:t}),i=[];s&&(i=s.route.map(e=>new p.Z({type:"marker",description:e.address,geometry:new j.Z((0,k.mi)([e.coords.lon,e.coords.lat]))})));let a=new v.Z({features:[l,...i]}),r={route:new b.ZP({stroke:new g.Z({color:[255,0,0,.8],width:3})}),marker:new b.ZP({image:new w.Z({radius:4,fill:new y.Z({color:"red"}),stroke:new g.Z({color:"white",width:2})})})},o=new f.Z({source:a,style:e=>r[e.get("type")]});if(n.current&&(n.current.addLayer(o),s&&s.route.length)){let{lon:e,lat:t}=s.route.slice(-1)[0].coords;n.current.getView().setCenter((0,k.vs)([e,t],"EPSG:4326","EPSG:3857"));let l=n.current.getView().getZoom();l&&l<=2&&n.current.getView().setZoom(12)}return()=>{n.current&&n.current.removeLayer(o)}},[s]),(0,a.useEffect)(()=>{if(n.current&&s&&s.route.length>0){let{lon:e,lat:t}=s.route[Math.round(s.route.length/2)].coords;n.current.getView().setCenter((0,k.vs)([e,t],"EPSG:4326","EPSG:3857")),n.current.getView().setZoom(12)}},[I]),(0,t.jsxs)("div",{className:i().mapWrapper,children:[(0,t.jsx)("div",{id:"mapdiv",ref:l,className:i().mapdiv}),(0,t.jsx)("div",{ref:G,className:"tag is-info",children:S}),E.length>0&&(0,t.jsxs)("div",{className:i().fadeInFadeOut,children:[(0,t.jsx)(C.G,{icon:r.KS0}),"\xa0",E.join(",")]},E.join(","))]})}function S(e){let{tab:s,onClickHandler:n}=e;return(0,t.jsx)("div",{className:"tabs is-boxed",children:(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{className:"list"===s?"is-active":"",children:(0,t.jsx)("a",{onClick:()=>n("list"),children:"Verbindungen"})}),(0,t.jsx)("li",{className:"import"===s?"is-active":"",children:(0,t.jsx)("a",{onClick:()=>n("import"),children:"Import"})}),(0,t.jsx)("li",{className:"export"===s?"is-active":"",children:(0,t.jsx)("a",{onClick:()=>n("export"),children:"Export"})})]})})}var Z=n(7868);let E=new Z.default("MyPublicTransit");E.version(1).stores({connections:"++id, name, type, route"});let P=()=>E.table("connections").orderBy("type").toArray().then(e=>e.sort((e,s)=>e.name.localeCompare(s.name))),_=e=>{E.table("connections").update(e.id,{...e})},I=e=>{E.table("connections").where("id").equals(e).delete().then(s=>{console.log("Successfully deleted item with id ".concat(e))})},T=e=>{E.table("connections").add(e)},F=()=>{fetch("/data.json").then(e=>e.json()).then(e=>{try{for(let s of e)T(s)}catch(e){console.log(e)}})};function R(){let[e,s]=(0,a.useState)(""),n=()=>{try{let s=JSON.parse(e);for(let e of s)T(e)}catch(e){console.log(e)}};return(0,t.jsxs)("div",{className:"import-form",children:[(0,t.jsxs)("div",{className:"field",children:[(0,t.jsx)("label",{className:"label",children:"Json-Input:"}),(0,t.jsx)("div",{className:"control",children:(0,t.jsx)("textarea",{className:"textarea",rows:10,onChange:e=>s(e.currentTarget.value)})})]}),(0,t.jsx)("div",{className:"field",children:(0,t.jsx)("div",{className:"control",children:(0,t.jsx)("button",{className:"button is-link",onClick:()=>n(),children:"Import"})})})]})}function L(){let[e,s]=(0,a.useState)("");(0,a.useEffect)(()=>{P().then(e=>JSON.stringify(e)).then(e=>s(e))},[]);let n=s=>{let n=new Blob([e],{type:"text/json"}),t=s.currentTarget;t.download="data.json",t.href=window.URL.createObjectURL(n)};return(0,t.jsxs)("div",{className:"export-form",children:[(0,t.jsxs)("div",{className:"field",children:[(0,t.jsx)("label",{className:"label",children:"Json-Output:"}),(0,t.jsx)("div",{className:"control",children:(0,t.jsx)("textarea",{className:"textarea",rows:10,value:e,readOnly:!0})})]}),(0,t.jsx)("div",{className:"field",children:(0,t.jsx)("div",{className:"control",children:(0,t.jsx)("a",{onClick:e=>n(e),children:(0,t.jsx)("button",{className:"button is-link",children:"Export as file"})})})})]})}function O(e){let{point:s,isLast:n,handleChangePoint:l,handleRemovePoint:i}=e,a=e=>{l({...s,position:e})},o=e=>{l({...s,address:e})},c=e=>{let n=e.split(","),t={lon:Number.parseFloat(n[0]),lat:Number.parseFloat(n[1])};l({...s,coords:t})};return(0,t.jsxs)("div",{className:"block",children:[(0,t.jsxs)("div",{className:"field",children:[(0,t.jsx)("div",{className:"label",children:"Address:"}),(0,t.jsxs)("div",{className:"control is-flex is-flex-direction-row",children:[(0,t.jsx)("input",{type:"text",className:"input",value:s.address,onChange:e=>o(e.currentTarget.value)}),(0,t.jsx)("button",{className:"button ml-2","data-tooltip":"request geo coordinates for address",onClick:()=>{let e="https://nominatim.openstreetmap.org/search?q=".concat(encodeURI(s.address),"&format=geocodejson&limit=1");fetch(e).then(e=>e.json()).then(e=>{try{let n=e.features[0].geometry.coordinates;l({...s,coords:{lon:n[0],lat:n[1]}})}catch(s){console.error(e)}})},children:(0,t.jsx)(C.G,{icon:r.opg})})]})]}),(0,t.jsxs)("div",{className:"field",children:[(0,t.jsxs)("div",{className:"label",children:["Latitude/Longitude:",(0,t.jsx)("span",{className:"icon","data-tooltip":"click on a place in the map to copy coordinates to clipboard",children:(0,t.jsx)(C.G,{icon:r.DBf})})]}),(0,t.jsx)("div",{className:"field",children:(0,t.jsx)("div",{className:"control",children:(0,t.jsx)("input",{type:"text",className:"input",value:s.coords.lon+","+s.coords.lat,onChange:e=>c(e.currentTarget.value)})})})]}),(0,t.jsxs)("div",{className:"field",children:[(0,t.jsx)("button",{className:"button is-small mr-2",onClick:()=>i(s.id),children:(0,t.jsx)(C.G,{icon:r.$aW})}),s.position>0&&(0,t.jsx)("button",{className:"button is-small mr-2",onClick:()=>a(s.position-1),children:(0,t.jsx)(C.G,{icon:r.FPD})}),!n&&(0,t.jsx)("button",{className:"button is-small mr-2",onClick:()=>a(s.position+1),children:(0,t.jsx)(C.G,{icon:r.r5q})})]})]})}var V=n(1872);function W(e){let{connection:s,isEdit:n,isVisible:l,handleSetVisibleId:i,handleSetEditId:o,handleUpdateConnection:c,handleRemoveConnection:d,handleChangeConnection:u}=e,[m,h]=(0,a.useState)(s.name),[x,j]=(0,a.useState)(s.type),p=(0,a.useMemo)(()=>s.route.sort((e,s)=>e.position-s.position),[s]),v=Math.max(...p.map(e=>e.position)),f=()=>{switch(x){case"bus":return(0,t.jsx)(C.G,{icon:r.k0d});case"tram":return(0,t.jsx)(C.G,{icon:r.tZ$});case"train":return(0,t.jsx)(C.G,{icon:r.DdW})}},N=()=>{c({id:s.id,name:m,type:x,route:[...p]})},b=e=>{let n=p.filter(s=>{if(s.id!==e)return s});u({id:s.id,name:m,type:x,route:n})},g=e=>{let n=p.filter(s=>s.id===e.id)[0].position,t=p.map(s=>s.id===e.id?e:(s.id!==e.id&&s.position===e.position&&(s.position=n),s));u({id:s.id,name:m,type:x,route:t})},w=()=>{let e=(0,V.Z)(),n=0,t=0;p.length&&(n=p[p.length-1].coords.lon,t=p[p.length-1].coords.lat);let l=[...p,{id:e,address:"",coords:{lon:n,lat:t},position:v+1}];u({id:s.id,name:m,type:x,route:l})};return(0,t.jsxs)("div",{className:"columns content",children:[(0,t.jsxs)("div",{className:"column is-two-thirds",children:[(0,t.jsxs)("div",{className:"field",children:[(0,t.jsx)("label",{className:"label",children:"Name:"}),(0,t.jsx)("div",{className:"control",children:n?(0,t.jsx)("input",{className:"input",type:"text",placeholder:"Bus, tram or train description",value:m,onChange:e=>h(e.currentTarget.value)}):(0,t.jsx)("p",{children:m})})]}),n&&(0,t.jsxs)("div",{className:"field",children:[(0,t.jsx)("label",{className:"label",children:"Type:"}),(0,t.jsx)("div",{className:"control",children:(0,t.jsx)("div",{className:"select",children:(0,t.jsxs)("select",{value:x,onChange:e=>j(e.currentTarget.value),children:[(0,t.jsx)("option",{value:"bus",children:"Bus"}),(0,t.jsx)("option",{value:"tram",children:"Tram"}),(0,t.jsx)("option",{value:"train",children:"Train"})]})})})]}),(0,t.jsxs)("div",{className:"field",children:[(0,t.jsx)("label",{className:"label",children:"Route:"}),(0,t.jsx)("div",{className:"control",children:n?(0,t.jsx)("ol",{children:p.map(e=>(0,t.jsx)("li",{children:(0,t.jsx)(O,{point:e,isLast:e.position===v,handleChangePoint:g,handleRemovePoint:b})},e.id))}):(()=>{let e=p.length?p[0].address:null,s=p.length>1?p[p.length-1].address:null;return(0,t.jsxs)("div",{children:[f(),e&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:"\xa0"}),e,(0,t.jsx)("span",{children:"\xa0"})]}),s&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(C.G,{icon:r.eFW}),(0,t.jsx)("span",{children:"\xa0"}),s,(0,t.jsx)("span",{children:"\xa0"}),(0,t.jsx)(C.G,{icon:r.ytF})]})]})})()})]}),n&&(0,t.jsx)("div",{className:"field",children:(0,t.jsx)("div",{className:"control",children:(0,t.jsxs)("button",{className:"button is-small",onClick:()=>w(),children:[(0,t.jsx)(C.G,{icon:r.r8p}),"\xa0 Add point"]})})}),n&&(0,t.jsx)("div",{className:"field",children:(0,t.jsx)("div",{className:"control",children:(0,t.jsx)("button",{className:"button is-link",onClick:()=>N(),children:"Submit"})})})]}),(0,t.jsxs)("div",{className:"column is-one-third",children:[(0,t.jsx)("button",{className:"button is-small mr-1",onClick:()=>i(s.id),children:l?(0,t.jsx)(C.G,{icon:r.Mdf}):(0,t.jsx)(C.G,{icon:r.Aq})}),(0,t.jsx)("button",{className:"button is-small mr-1",onClick:()=>o(s.id),children:n?(0,t.jsx)(C.G,{icon:r.g82}):(0,t.jsx)(C.G,{icon:r.IwR})}),(0,t.jsx)("button",{className:"button is-small",onClick:()=>d(s.id),children:(0,t.jsx)(C.G,{icon:r.$aW})})]})]})}function A(e){let{connections:s,visibleId:n,handleSetVisibleId:l,handleChangeConnection:i}=e,[r,o]=(0,a.useState)(null),c=e=>{r===e?o(null):(o(e),l(e,!0))},d=e=>{_(e),o(null)},u=e=>{I(e)};return(0,t.jsxs)("div",{className:"connections-list",children:[(0,t.jsx)("div",{className:"block",children:(0,t.jsx)("button",{className:"button is-primary",onClick:()=>{T({name:"New connection",type:"bus",route:[]})},children:"Add connection"})}),(0,t.jsxs)("div",{className:"block",children:[!s.length&&(0,t.jsxs)("p",{children:["This looks very empty here, maybe you want to add some ",(0,t.jsx)("a",{onClick:()=>F(),children:"data"}),"."]}),s.map((e,o)=>(0,t.jsxs)(a.Fragment,{children:[(0,t.jsx)(W,{isEdit:r===e.id,isVisible:n===e.id,connection:e,handleSetVisibleId:l,handleSetEditId:c,handleUpdateConnection:d,handleRemoveConnection:u,handleChangeConnection:i}),o<s.length-1&&(0,t.jsx)("hr",{})]},e.id))]})]})}n(4375);var M=n(7398);function q(){let e;let[s,n]=(0,a.useState)([]),[l,i]=(0,a.useState)(null),[o,c]=(0,a.useState)("list"),d=(0,M.useLiveQuery)(()=>{let e=P();return e.then(e=>{n(e)}),e||[]},[]);(0,a.useEffect)(()=>{s.length&&null===l&&i(s[0].id)},[s]);let u=(0,t.jsxs)("p",{children:["Loading .. ",(0,t.jsx)(C.G,{icon:r.LM3,spin:!0})]});return(0,t.jsx)("main",{children:(0,t.jsxs)("div",{className:"columns",children:[(0,t.jsxs)("div",{className:"column is-one-third",children:[(0,t.jsx)(S,{tab:o,onClickHandler:c}),"list"===o&&(d?(0,t.jsx)(A,{connections:s,visibleId:l,handleSetVisibleId:function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];l!==e||s?i(e):i(null)},handleChangeConnection:e=>{n(s.map(s=>s.id===e.id?e:s))}}):u),"import"===o&&(0,t.jsx)(R,{}),"export"===o&&(0,t.jsx)(L,{})]}),(0,t.jsx)("div",{className:"column is-two-thirds",children:(0,t.jsx)(G,{connection:(e=null,s&&s.length&&(e=s.filter(e=>e.id===l)[0]),e)})})]})})}},3389:function(e){e.exports={mapWrapper:"styles_mapWrapper__PI80H",mapdiv:"styles_mapdiv__oTjGv",fadeInFadeOut:"styles_fadeInFadeOut__1DRiz",fade:"styles_fade__2Ismz"}}},function(e){e.O(0,[676,876,971,596,744],function(){return e(e.s=5803)}),_N_E=e.O()}]);
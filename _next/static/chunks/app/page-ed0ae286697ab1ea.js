(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5803:function(e,s,n){Promise.resolve().then(n.bind(n,7810))},7810:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return T}});var l=n(7437);n(9745);var t=n(3389),i=n.n(t),a=n(2265),c=n(2390),r=n.n(c),o=n(7327),d=n(4542),u=n(7633),m=n(20),h=n(1342),x=n(6916),j=n(771),v=n(5034),p=n(1655),N=n(3794),b=n(3276);function f(e){let{connection:s}=e,n=(0,a.useRef)(null),t=(0,a.useRef)(null),c=()=>s?s.route.map(e=>[e.coords.lon,e.coords.lat]):[];return(0,a.useEffect)(()=>{let e=new o.Z;return e.addLayer(new m.Z({source:new u.Z})),e.setTarget(t.current),e.setView(new d.ZP({center:[0,0],zoom:2})),e.on("click",e=>{console.log(e.coordinate);let s=(0,b.bU)(e.coordinate);console.log(s),r()(s.toString())}),n.current=e,()=>{n.current&&n.current.setTarget(void 0)}},[]),(0,a.useEffect)(()=>{let e=c(),l=new h.Z(e);l.transform("EPSG:4326","EPSG:3857");let t=new x.Z({geometry:l}),i=new j.Z({features:[t]}),a=new v.Z({source:i,style:new p.ZP({stroke:new N.Z({color:"red",width:3})})});return n.current&&(n.current.addLayer(a),s&&s.route.length&&n.current.getView().setCenter((0,b.vs)([s.route[0].coords.lon,s.route[0].coords.lat],"EPSG:4326","EPSG:3857")),n.current.getView().setZoom(12)),()=>{n.current&&n.current.removeLayer(a)}},[s]),(0,l.jsx)("div",{id:"mapdiv",ref:t,className:i().mapdiv})}var g=n(7868);let w=new g.default("MyPublicTransit");w.version(1).stores({connections:"++id, name, type, route"});var y=n(2759),k=n(504);function G(e){let{point:s,handleChangePoint:n,handleRemovePoint:t}=e,[i,c]=(0,a.useState)(s.address),[r,o]=(0,a.useState)(s.coords),d=e=>{let l=e.currentTarget.value;c(l),n({id:s.id,address:l,coords:r})},u=e=>{let l=e.currentTarget.value.split(","),t=Number.parseFloat(l[0]),a=Number.parseFloat(l[1]);o({lon:t,lat:a}),n({id:s.id,address:i,coords:{lat:a,lon:t}})};return(0,l.jsxs)("div",{className:"block",children:[(0,l.jsxs)("div",{className:"field",children:[(0,l.jsx)("div",{className:"label",children:"Address:"}),(0,l.jsxs)("div",{className:"control is-flex is-flex-direction-row",children:[(0,l.jsx)("input",{type:"text",className:"input",value:i,onChange:e=>d(e)}),(0,l.jsx)("button",{className:"button ml-2","data-tooltip":"request geo coordinates for address",onClick:()=>{let e="https://nominatim.openstreetmap.org/search?q=".concat(encodeURI(i),"&format=geocodejson&limit=1");fetch(e).then(e=>e.json()).then(e=>{try{let l=e.features[0].geometry.coordinates;o({lon:l[0],lat:l[1]}),n({id:s.id,address:i,coords:{lon:l[0],lat:l[1]}})}catch(s){console.error(e)}})},children:(0,l.jsx)(k.G,{icon:y.opg})})]})]}),(0,l.jsxs)("div",{className:"field",children:[(0,l.jsxs)("div",{className:"label",children:["Latitude/Longitude:",(0,l.jsx)("span",{className:"icon","data-tooltip":"click on a place in the map to copy coordinates to clipboard",children:(0,l.jsx)(k.G,{icon:y.DBf})})]}),(0,l.jsx)("div",{className:"field-body",children:(0,l.jsx)("div",{className:"field",children:(0,l.jsx)("div",{className:"control",children:(0,l.jsx)("input",{type:"text",className:"input",value:r.lon+","+r.lat,onChange:e=>u(e)})})})})]}),(0,l.jsx)("div",{className:"field",children:(0,l.jsx)("button",{className:"button is-small",onClick:()=>t(s.id),children:(0,l.jsx)(k.G,{icon:y.$aW})})})]})}var C=n(1872);function S(e){let{connection:s,isEdit:n,isVisible:t,handleSetVisibleId:i,handleSetEditId:c,handleUpdateItem:r,handleRemoveItem:o}=e,[d,u]=(0,a.useState)(s.name),[m,h]=(0,a.useState)(s.type),[x,j]=(0,a.useState)(s.route),v=()=>{r({id:s.id,name:d,type:m,route:[...x]})},p=e=>{j(x.filter(s=>{if(s.id!==e)return s}))},N=e=>{j(x.map(s=>s.id===e.id?e:s))},b=()=>{let e=(0,C.Z)();j([...x,{id:e,address:"",coords:{lat:0,lon:0}}])};return(0,l.jsxs)("div",{className:"columns content",children:[(0,l.jsxs)("div",{className:"column is-two-thirds",children:[(0,l.jsxs)("div",{className:"field",children:[(0,l.jsx)("label",{className:"label",children:"Name:"}),(0,l.jsx)("div",{className:"control",children:n?(0,l.jsx)("input",{className:"input",type:"text",placeholder:"Bus, tram or train description",value:d,onChange:e=>u(e.currentTarget.value)}):(0,l.jsx)("p",{children:d})})]}),n&&(0,l.jsxs)("div",{className:"field",children:[(0,l.jsx)("label",{className:"label",children:"Type:"}),(0,l.jsx)("div",{className:"control",children:(0,l.jsx)("div",{className:"select",children:(0,l.jsxs)("select",{value:m,onChange:e=>h(e.currentTarget.value),children:[(0,l.jsx)("option",{value:"bus",children:"Bus"}),(0,l.jsx)("option",{value:"tram",children:"Tram"}),(0,l.jsx)("option",{value:"train",children:"Train"})]})})})]}),(0,l.jsxs)("div",{className:"field",children:[(0,l.jsx)("label",{className:"label",children:"Route:"}),(0,l.jsx)("div",{className:"control",children:n?(0,l.jsx)("ol",{children:x.map(e=>(0,l.jsx)("li",{children:(0,l.jsx)(G,{point:e,handleChangePoint:N,handleRemovePoint:p})},e.id))}):(0,l.jsxs)("div",{children:[(()=>{switch(m){case"bus":return(0,l.jsx)(k.G,{icon:y.k0d});case"tram":return(0,l.jsx)(k.G,{icon:y.tZ$});case"train":return(0,l.jsx)(k.G,{icon:y.DdW})}})(),(0,l.jsx)("span",{children:"\xa0"}),x.map((e,s)=>(0,l.jsxs)(a.Fragment,{children:[(0,l.jsxs)("span",{children:[e.address,"\xa0"]}),s<x.length-1?(0,l.jsx)(k.G,{icon:y.eFW}):(0,l.jsx)(k.G,{icon:y.ytF}),(0,l.jsx)("span",{children:"\xa0"})]},s))]})})]}),n&&(0,l.jsx)("div",{className:"field",children:(0,l.jsx)("div",{className:"control",children:(0,l.jsxs)("button",{className:"button is-small",onClick:()=>b(),children:[(0,l.jsx)(k.G,{icon:y.r8p}),"\xa0 Add point"]})})}),n&&(0,l.jsx)("div",{className:"field",children:(0,l.jsx)("div",{className:"control",children:(0,l.jsx)("button",{className:"button is-link",onClick:()=>v(),children:"Submit"})})})]}),(0,l.jsxs)("div",{className:"column is-one-third",children:[(0,l.jsx)("button",{className:"button is-small mr-1",onClick:()=>i(s.id),children:t?(0,l.jsx)(k.G,{icon:y.Mdf}):(0,l.jsx)(k.G,{icon:y.Aq})}),(0,l.jsx)("button",{className:"button is-small mr-1",onClick:()=>c(s.id),children:(0,l.jsx)(k.G,{icon:y.IwR})}),(0,l.jsx)("button",{className:"button is-small",onClick:()=>o(s.id),children:(0,l.jsx)(k.G,{icon:y.$aW})})]})]})}function Z(e){let{connections:s,visibleId:n,handleSetVisibleId:t}=e,[i,c]=(0,a.useState)(null),r=e=>{i===e?c(null):c(e)},o=e=>{w.table("connections").update(e.id,{...e}),c(null)},d=e=>{w.table("connections").where("id").equals(e).delete().then(s=>{console.log("Successfully deleted item with id ".concat(e))})};return(0,l.jsxs)("div",{className:"connections-list",children:[(0,l.jsx)("div",{className:"block",children:(0,l.jsx)("button",{className:"button is-primary",onClick:()=>{w.table("connections").add({name:"New connection",type:"bus",route:[]})},children:"Add connection"})}),(0,l.jsxs)("div",{className:"block",children:[(0,l.jsx)("h2",{className:"title is-4",children:"Connections:"}),s.map((e,c)=>(0,l.jsxs)(a.Fragment,{children:[(0,l.jsx)(S,{isEdit:i===e.id,isVisible:n===e.id,connection:e,handleUpdateItem:o,handleSetVisibleId:t,handleSetEditId:r,handleRemoveItem:d}),c<s.length-1&&(0,l.jsx)("hr",{})]},e.id))]})]})}n(4375);var E=n(7398);function T(){let e;let s=(0,E.useLiveQuery)(()=>{let e=w.table("connections").toArray();return e.then(e=>{e.length&&null===n&&t(e[0].id)}),e||[]},[]),[n,t]=(0,a.useState)(s&&s.length?s[0].id:null),i=(0,l.jsxs)("p",{children:["Loading .. ",(0,l.jsx)(k.G,{icon:y.LM3,spin:!0})]});return(0,l.jsx)("main",{children:(0,l.jsxs)("div",{className:"columns",children:[(0,l.jsx)("div",{className:"column is-one-third",children:s?(0,l.jsx)(Z,{connections:s,visibleId:n,handleSetVisibleId:e=>{n===e?t(null):t(e)}}):i}),(0,l.jsx)("div",{className:"column is-two-thirds",children:(0,l.jsx)(f,{connection:(e=null,s&&s.length&&(e=s.filter(e=>e.id===n)[0]),e)})})]})})}},3389:function(e){e.exports={mapdiv:"styles_mapdiv__oTjGv"}}},function(e){e.O(0,[676,444,971,596,744],function(){return e(e.s=5803)}),_N_E=e.O()}]);